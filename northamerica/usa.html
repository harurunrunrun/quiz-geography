<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>USA市外局番クイズ(初級)</title>
<style>
body { font-family: sans-serif; margin: 0; padding: 0; }
#header { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 8px; margin: 12px; font-weight: bold; font-size: 1rem; }
#stats  { white-space: nowrap; }
#tweetBtn { font-size: 0.9rem; text-decoration: none; border: 1px solid #1d9bf0; padding: 4px 8px; border-radius: 4px; }
#tweetBtn:hover { background: #e8f5fe; }
#pn { margin: 24px auto 16px; font-weight: bold; font-size: 2.4rem; width: 90%; max-width: 500px; text-align: center; }
.container { width: 90%; max-width: 400px; margin: 0 auto; }
.option { border: 2px solid #333; padding: 14px 12px; margin-bottom: 14px; text-align: center; transition: background 0.2s ease; position: relative; font-size: 1rem; cursor: pointer; }
.option:hover   { background: #f0f0f0; }
.option.disabled{ opacity: 0.5; pointer-events: none; cursor: default; }
.option.correct { color: red; }
.option.wrong   { color: #333; }
.marker { position: absolute; left: -20px; top: 50%; transform: translateY(-50%); font-size: 1.2rem; font-weight: bold; }
.marker.circle { color: red;  }
.marker.cross  { color: blue; }
#nextBtn { display: none; margin: 24px auto; padding: 10px 20px; font-size: 1rem; cursor: pointer; display: block; }
@media (min-width: 480px){ #header{flex-wrap:nowrap;} .marker{left:-24px;} #nextBtn{max-width:400px;} }
</style>
</head>
<body>

<div id="header">
  <div id="stats">正解 0 / 連続 0 / 最高連続 0 / 正解率 0.0%</div>
  <a id="tweetBtn" href="#" target="_blank">X でポスト</a>
</div>
<h2 id="pn">読み込み中…</h2>
<div class="container" id="options"></div>
<button id="nextBtn">次へ</button>

<script>
let jsonData      = null;
let correctAnswer = null;
let totalCorrect  = 0;
let currentStreak = 0;
let maxStreak     = 0;
let totalQuestions = 0;    

const isTouchDevice = (('maxTouchPoints' in navigator && navigator.maxTouchPoints > 0) || 'ontouchstart' in window || /Mobi|Android/i.test(navigator.userAgent));


function updateStats(){
    const rate = totalQuestions ? (totalCorrect / totalQuestions * 100).toFixed(1) : '0.0';
    const url = "https://harurunrunrun.github.io/quiz-geography";
    document.getElementById('stats').textContent = `正解 ${totalCorrect} / 連続 ${currentStreak} / 最高連続 ${maxStreak} / 正解率 ${rate}%`;
    const tweetText = `USA市外局番クイズ(初級): 正解数 ${totalCorrect}，最高連続 ${maxStreak}，正解率 ${rate}% ${url}`;
    document.getElementById('tweetBtn').href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;
}

function shuffle(arr){
    for(let i = arr.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

function pickUnique(array, count, exclude){
    const pool = array.filter(a => a !== exclude);
    const unique = [...new Set(pool)];
    shuffle(unique);
    return unique.slice(0, count);
}

function initQuiz(){
    const container=document.getElementById('options');
    container.replaceChildren();

    const entries=Object.entries(jsonData);
    const [qText,qAns]=entries[Math.floor(Math.random()*entries.length)];
    correctAnswer=qAns;
    const distractors=pickUnique(entries.map(e=>e[1]),3,qAns);
    const choices=shuffle([qAns,...distractors]);

    document.getElementById('pn').textContent=qText;
    container.classList.remove('locked');

    choices.forEach(ans=>{
        const div=document.createElement('div');
        div.className='option';
        div.textContent=ans;
        div.dataset.answer=ans;
        div.addEventListener('click',()=>onClick(div));
        container.appendChild(div);
    });

    document.getElementById('nextBtn').style.display='none';
    updateStats();
}

function onClick(el){
    const container=el.parentNode;
    if(container.classList.contains('locked')) return;
    container.classList.add('locked');

    document.querySelectorAll('.option').forEach(o=>{ if(o!==el) { o.classList.add('disabled'); o.style.cursor='default'; } else { o.style.cursor='default'; } });

    totalQuestions++;
    if(el.dataset.answer===correctAnswer){
        el.insertAdjacentHTML('afterbegin','<span class="marker circle">⭕</span>');
        totalCorrect++; currentStreak++; if(currentStreak>maxStreak) maxStreak=currentStreak;
    } else {
        el.insertAdjacentHTML('afterbegin','<span class="marker cross">×</span>');
        el.classList.add('wrong'); currentStreak=0;
        document.querySelectorAll('.option').forEach(o=>{ if(o.dataset.answer===correctAnswer){ o.insertAdjacentHTML('afterbegin','<span class="marker circle">⭕</span>'); o.classList.add('correct'); } });
    }

    updateStats();
    document.getElementById('nextBtn').style.display='block';
}

document.getElementById('nextBtn').addEventListener('click', initQuiz);

document.addEventListener('DOMContentLoaded', () => {
    jsonData = JSON.parse(document.getElementById('quiz-data').textContent);
    initQuiz();
});
</script>

<script id="quiz-data" type="application/json">
{
    "907" : "アラスカ",

    "808" : "ハワイ",

    "360" : "ワシントン",
    "564" : "ワシントン",
    "253" : "ワシントン",
    "206" : "ワシントン",
    "425" : "ワシントン",
    "509" : "ワシントン",

    "503" : "オレゴン",
    "971" : "オレゴン",
    "458" : "オレゴン",
    "541" : "オレゴン",

    "530" : "カリフォルニア",
    "707" : "カリフォルニア",
    "916" : "カリフォルニア",
    "510" : "カリフォルニア",
    "415" : "カリフォルニア",
    "650" : "カリフォルニア",
    "925" : "カリフォルニア",
    "669" : "カリフォルニア",
    "209" : "カリフォルニア",
    "831" : "カリフォルニア",
    "559" : "カリフォルニア",
    "805" : "カリフォルニア",
    "661" : "カリフォルニア",
    "442" : "カリフォルニア",
    "909" : "カリフォルニア",
    "951" : "カリフォルニア",
    "619" : "カリフォルニア",
    "858" : "カリフォルニア",
    "714" : "カリフォルニア",
    "213" : "カリフォルニア",
    "310" : "カリフォルニア",
    "818" : "カリフォルニア",
    "323" : "カリフォルニア",
    "562" : "カリフォルニア",
    "626" : "カリフォルニア",
    "949" : "カリフォルニア",

    "775" : "ネバタ",
    "702" : "ネバタ",

    "208" : "アイダホ",

    "406" : "モンタナ",

    "307" : "ワイオミング",

    "801" : "ユタ",
    "385" : "ユタ",
    "435" : "ユタ",

    "928" : "アリゾナ",
    "602" : "アリゾナ",
    "623" : "アリゾナ",
    "480" : "アリゾナ",
    "520" : "アリゾナ",

    "970" : "コロラド",
    "720" : "コロラド",
    "303" : "コロラド",
    "719" : "コロラド",

    "505" : "ニューメキシコ",
    "575" : "ニューメキシコ",

    "806" : "テキサス",
    "915" : "テキサス",
    "940" : "テキサス",
    "432" : "テキサス",
    "325" : "テキサス",
    "817" : "テキサス",
    "214" : "テキサス",
    "903" : "テキサス",
    "254" : "テキサス",
    "936" : "テキサス",
    "409" : "テキサス",
    "713" : "テキサス",
    "979" : "テキサス",
    "830" : "テキサス",
    "210" : "テキサス",
    "361" : "テキサス",
    "956" : "テキサス",

    "580" : "オクラホマ",
    "405" : "オクラホマ",
    "539" : "オクラホマ",
    "918" : "オクラホマ",

    "785" : "カンザス",
    "620" : "カンザス",
    "913" : "カンザス",
    "316" : "カンザス",

    "308" : "ネブラスカ",
    "402" : "ネブラスカ",
    "531" : "ネブラスカ",

    "605" : "サウスダコタ",

    "701" : "ノースダコタ",

    "218" : "ミネソタ",
    "763" : "ミネソタ",
    "320" : "ミネソタ",
    "612" : "ミネソタ",
    "651" : "ミネソタ",
    "952" : "ミネソタ",
    "507" : "ミネソタ",

    "712" : "アイオワ",
    "515" : "アイオワ",
    "563" : "アイオワ",
    "319" : "アイオワ",
    "641" : "アイオワ",

    "660" : "ミズーリ",
    "816" : "ミズーリ",
    "314" : "ミズーリ",
    "636" : "ミズーリ",
    "417" : "ミズーリ",
    "573" : "ミズーリ",

    "479" : "アーカンソー",
    "501" : "アーカンソー",
    "870" : "アーカンソー",

    "318" : "ルイジアナ",
    "225" : "ルイジアナ",
    "337" : "ルイジアナ",
    "985" : "ルイジアナ",
    "504" : "ルイジアナ",

    "534" : "ウィスコンシン",
    "715" : "ウィスコンシン",
    "920" : "ウィスコンシン",
    "608" : "ウィスコンシン",
    "414" : "ウィスコンシン",
    "262" : "ウィスコンシン",

    "815" : "イリノイ",
    "630" : "イリノイ",
    "309" : "イリノイ",
    "217" : "イリノイ",
    "618" : "イリノイ",

    "906" : "ミシガン",
    "989" : "ミシガン",
    "231" : "ミシガン",
    "810" : "ミシガン",
    "313" : "ミシガン",
    "616" : "ミシガン",
    "269" : "ミシガン",
    "517" : "ミシガン",
    "734" : "ミシガン",

    "574" : "インディアナ",
    "219" : "インディアナ",
    "260" : "インディアナ",
    "765" : "インディアナ",
    "317" : "インディアナ",
    "812" : "インディアナ",

    "419" : "オハイオ",
    "937" : "オハイオ",
    "216" : "オハイオ",
    "440" : "オハイオ",
    "330" : "オハイオ",
    "614" : "オハイオ",
    "740" : "オハイオ",
    "283" : "オハイオ",
    "513" : "オハイオ",
    
    "270" : "ケンタッキー",
    "364" : "ケンタッキー",
    "502" : "ケンタッキー",
    "859" : "ケンタッキー",
    "606" : "ケンタッキー",

    "731" : "テネシー",
    "901" : "テネシー",
    "615" : "テネシー",
    "931" : "テネシー",
    "423" : "テネシー",
    "865" : "テネシー",
    
    "662" : "ミシシッピ",
    "601" : "ミシシッピ",
    "228" : "ミシシッピ",

    "938" : "アラバマ",
    "205" : "アラバマ",
    "334" : "アラバマ",
    "251" : "アラバマ",

    "678" : "ジョージア",
    "706" : "ジョージア",
    "404" : "ジョージア",
    "478" : "ジョージア",
    "229" : "ジョージア",
    "912" : "ジョージア",

    "850" : "フロリダ",
    "386" : "フロリダ",
    "904" : "フロリダ",
    "352" : "フロリダ",
    "407" : "フロリダ",
    "321" : "フロリダ",
    "727" : "フロリダ",
    "813" : "フロリダ",
    "772" : "フロリダ",
    "941" : "フロリダ",
    "863" : "フロリダ",
    "561" : "フロリダ",
    "239" : "フロリダ",
    "954" : "フロリダ",
    "764" : "フロリダ",
    "305" : "フロリダ",
    "786" : "フロリダ",

    "864" : "サウスカロライナ",
    "803" : "サウスカロライナ",
    "843" : "サウスカロライナ",

    "828" : "ノースカロライナ",
    "704" : "ノースカロライナ",
    "336" : "ノースカロライナ",
    "919" : "ノースカロライナ",
    "252" : "ノースカロライナ",
    "910" : "ノースカロライナ",

    "276" : "ヴァージニア",
    "434" : "ヴァージニア",
    "757" : "ヴァージニア",
    "804" : "ヴァージニア",
    "540" : "ヴァージニア",

    "304" : "ウエストヴァージニア",
    "681" : "ウエストヴァージニア",

    "202" : "メリーランド",
    "667" : "メリーランド",

    "856" : "デラウェア",

    "609" : "ニュージャージー",
    "973" : "ニュージャージー",
    "201" : "ニュージャージー",
    "631" : "ニュージャージー",

    "814" : "ペンシルベニア",
    "724" : "ペンシルベニア",
    "412" : "ペンシルベニア",
    "301" : "ペンシルベニア",
    "570" : "ペンシルベニア",
    "908" : "ペンシルベニア",
    "610" : "ペンシルベニア",
    "717" : "ペンシルベニア",

    "716" : "ニューヨーク",
    "585" : "ニューヨーク",
    "607" : "ニューヨーク",
    "315" : "ニューヨーク",
    "518" : "ニューヨーク",
    "845" : "ニューヨーク",
    "914" : "ニューヨーク",

    "203" : "コネチカット",

    "860" : "コネチカット & ロードアイランド",

    "413" : "マサチューセッツ",
    "401" : "マサチューセッツ & ロードアイランド",
    "978" : "マサチューセッツ",

    "802" : "バーモント",

    "603" : "ニューハンプシャー",

    "207" : "メイン"
}
</script>

</body>
</html>
